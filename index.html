<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>NutriTrack — Elia & Alex</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=DM+Mono:wght@400;500&family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
  import { getFirestore, collection, doc, setDoc, getDoc, getDocs, addDoc, query, orderBy, onSnapshot, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "AIzaSyA7R-rCJ1B63j95qPctFf0gYgCiVtOvvOw",
    authDomain: "dietapp-8ad72.firebaseapp.com",
    projectId: "dietapp-8ad72",
    storageBucket: "dietapp-8ad72.firebasestorage.app",
    messagingSenderId: "903928286116",
    appId: "1:903928286116:web:84a2013356a2740fed8f31"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);
  window.db = db;
  window.dbFns = { collection, doc, setDoc, getDoc, getDocs, addDoc, query, orderBy, onSnapshot, updateDoc, deleteDoc };
  window.firebaseReady = true;
  document.dispatchEvent(new Event('firebaseReady'));
</script>

<style>
:root {
  --bg: #0a0c0f;
  --bg2: #111318;
  --bg3: #181c23;
  --card: #1a1f29;
  --card2: #1f2535;
  --border: #2a3045;
  --accent: #a3e635;
  --accent2: #4ade80;
  --accent3: #22d3ee;
  --elia: #f97316;
  --alex: #818cf8;
  --text: #e8eaf0;
  --muted: #6b7280;
  --danger: #f87171;
  --font-display: 'Syne', sans-serif;
  --font-body: 'DM Sans', sans-serif;
  --font-mono: 'DM Mono', monospace;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

body {
  background: var(--bg);
  color: var(--text);
  font-family: var(--font-body);
  min-height: 100vh;
  overflow-x: hidden;
}

/* ─── SIDEBAR NAV ─── */
.sidebar {
  position: fixed;
  left: 0; top: 0;
  width: 72px;
  height: 100vh;
  background: var(--bg2);
  border-right: 1px solid var(--border);
  display: flex;
  flex-direction: column;
  align-items: center;
  padding: 24px 0;
  gap: 8px;
  z-index: 100;
}

.logo {
  font-family: var(--font-display);
  font-weight: 800;
  font-size: 11px;
  color: var(--accent);
  letter-spacing: 2px;
  writing-mode: vertical-rl;
  transform: rotate(180deg);
  margin-bottom: 24px;
}

.nav-btn {
  width: 44px; height: 44px;
  border-radius: 12px;
  border: none;
  background: transparent;
  cursor: pointer;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  gap: 3px;
  transition: all 0.2s;
  position: relative;
}

.nav-btn svg { width: 20px; height: 20px; stroke: var(--muted); fill: none; stroke-width: 1.8; transition: stroke 0.2s; }
.nav-btn span { font-size: 8px; color: var(--muted); font-family: var(--font-mono); letter-spacing: 0.5px; transition: color 0.2s; }

.nav-btn:hover { background: var(--bg3); }
.nav-btn:hover svg { stroke: var(--text); }
.nav-btn:hover span { color: var(--text); }

.nav-btn.active { background: rgba(163,230,53,0.08); }
.nav-btn.active svg { stroke: var(--accent); }
.nav-btn.active span { color: var(--accent); }
.nav-btn.elia-btn.active { background: rgba(249,115,22,0.1); }
.nav-btn.elia-btn.active svg { stroke: var(--elia); }
.nav-btn.elia-btn.active span { color: var(--elia); }
.nav-btn.alex-btn.active { background: rgba(129,140,248,0.1); }
.nav-btn.alex-btn.active svg { stroke: var(--alex); }
.nav-btn.alex-btn.active span { color: var(--alex); }

/* ─── MAIN ─── */
.main {
  margin-left: 72px;
  min-height: 100vh;
  padding: 32px;
}

/* ─── PAGES ─── */
.page { display: none; }
.page.active { display: block; animation: fadeIn 0.3s ease; }

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(8px); }
  to { opacity: 1; transform: translateY(0); }
}

/* ─── TYPOGRAPHY ─── */
h1 { font-family: var(--font-display); font-weight: 800; font-size: 32px; letter-spacing: -0.5px; }
h2 { font-family: var(--font-display); font-weight: 700; font-size: 20px; }
h3 { font-family: var(--font-display); font-weight: 600; font-size: 16px; }

.page-header {
  display: flex;
  align-items: flex-end;
  justify-content: space-between;
  margin-bottom: 32px;
}

.page-title { display: flex; flex-direction: column; gap: 4px; }
.page-tag { font-family: var(--font-mono); font-size: 11px; color: var(--muted); letter-spacing: 2px; text-transform: uppercase; }

/* ─── CARDS ─── */
.card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 16px;
  padding: 24px;
}

.card-sm { padding: 16px; border-radius: 12px; }

/* ─── GRID ─── */
.grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
.grid-3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px; }
.grid-4 { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; }

/* ─── STATS ─── */
.stat-card {
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: 14px;
  padding: 20px;
  position: relative;
  overflow: hidden;
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0; left: 0; right: 0;
  height: 2px;
}

.stat-card.elia::before { background: var(--elia); }
.stat-card.alex::before { background: var(--alex); }
.stat-card.green::before { background: var(--accent); }

.stat-label { font-family: var(--font-mono); font-size: 10px; color: var(--muted); letter-spacing: 1.5px; text-transform: uppercase; margin-bottom: 8px; }
.stat-value { font-family: var(--font-display); font-weight: 700; font-size: 28px; }
.stat-sub { font-size: 12px; color: var(--muted); margin-top: 4px; }

/* ─── INPUTS ─── */
input, select, textarea {
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 10px;
  color: var(--text);
  font-family: var(--font-body);
  font-size: 14px;
  padding: 10px 14px;
  outline: none;
  transition: border-color 0.2s;
  width: 100%;
}

input:focus, select:focus, textarea:focus { border-color: var(--accent); }
select option { background: var(--bg3); }
textarea { resize: vertical; min-height: 80px; }

/* ─── BUTTONS ─── */
.btn {
  border: none;
  border-radius: 10px;
  cursor: pointer;
  font-family: var(--font-body);
  font-weight: 500;
  font-size: 14px;
  padding: 10px 20px;
  transition: all 0.2s;
  white-space: nowrap;
}

.btn-primary {
  background: var(--accent);
  color: #0a0c0f;
}
.btn-primary:hover { background: #c4f000; transform: translateY(-1px); }

.btn-elia { background: var(--elia); color: white; }
.btn-elia:hover { background: #fb923c; }
.btn-alex { background: var(--alex); color: white; }
.btn-alex:hover { background: #a5b4fc; }

.btn-ghost {
  background: transparent;
  border: 1px solid var(--border);
  color: var(--text);
}
.btn-ghost:hover { background: var(--bg3); }
.btn-danger { background: rgba(248,113,113,0.15); color: var(--danger); border: 1px solid rgba(248,113,113,0.3); }
.btn-danger:hover { background: rgba(248,113,113,0.25); }

.btn-sm { padding: 6px 12px; font-size: 12px; border-radius: 8px; }
.btn-icon { width: 34px; height: 34px; padding: 0; display: inline-flex; align-items: center; justify-content: center; }

/* ─── WEIGHT INPUT SECTION ─── */
.weight-input-row {
  display: flex;
  align-items: center;
  gap: 12px;
}

.weight-input-row input[type="number"] {
  width: 120px;
  font-size: 20px;
  font-family: var(--font-mono);
  text-align: center;
}

/* ─── CHART ─── */
.chart-wrap {
  position: relative;
  height: 260px;
  width: 100%;
}

/* ─── PERSON BADGE ─── */
.person-badge {
  display: inline-flex;
  align-items: center;
  gap: 8px;
  padding: 6px 14px;
  border-radius: 100px;
  font-family: var(--font-mono);
  font-size: 12px;
  font-weight: 500;
  letter-spacing: 1px;
}

.person-badge.elia { background: rgba(249,115,22,0.15); color: var(--elia); }
.person-badge.alex { background: rgba(129,140,248,0.15); color: var(--alex); }

/* ─── FOOD PLAN ─── */
.meal-item {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 16px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 10px;
  margin-bottom: 8px;
}

.meal-item .food-name { flex: 1; font-weight: 500; font-size: 14px; }
.meal-item .gram-input { width: 80px; text-align: center; }
.macros-mini { display: flex; gap: 8px; }
.macro-chip {
  font-family: var(--font-mono);
  font-size: 10px;
  padding: 3px 8px;
  border-radius: 6px;
  white-space: nowrap;
}
.macro-chip.kcal { background: rgba(163,230,53,0.12); color: var(--accent); }
.macro-chip.prot { background: rgba(74,222,128,0.12); color: var(--accent2); }
.macro-chip.carb { background: rgba(34,211,238,0.12); color: var(--accent3); }
.macro-chip.fat { background: rgba(251,191,36,0.12); color: #fbbf24; }

/* ─── TOTALS BAR ─── */
.totals-bar {
  display: flex;
  gap: 16px;
  padding: 16px 20px;
  background: var(--bg);
  border: 1px solid var(--border);
  border-radius: 12px;
  margin: 16px 0;
}

.total-item { text-align: center; }
.total-item .val { font-family: var(--font-display); font-weight: 700; font-size: 20px; }
.total-item .lbl { font-family: var(--font-mono); font-size: 9px; color: var(--muted); letter-spacing: 1px; }

/* ─── EXCESS TABLE ─── */
.excess-table { width: 100%; border-collapse: collapse; }
.excess-table th {
  text-align: left;
  font-family: var(--font-mono);
  font-size: 10px;
  color: var(--muted);
  letter-spacing: 1.5px;
  padding: 8px 12px;
  border-bottom: 1px solid var(--border);
}
.excess-table td {
  padding: 10px 12px;
  font-size: 13px;
  border-bottom: 1px solid rgba(42,48,69,0.5);
}
.excess-table tr:last-child td { border-bottom: none; }
.excess-table tr:hover td { background: var(--bg3); }

/* ─── GOAL BAR ─── */
.goal-progress {
  height: 8px;
  background: var(--bg);
  border-radius: 100px;
  overflow: hidden;
  margin: 8px 0;
}
.goal-progress-fill {
  height: 100%;
  border-radius: 100px;
  transition: width 0.6s cubic-bezier(0.4,0,0.2,1);
}

/* ─── TABS ─── */
.tabs {
  display: flex;
  gap: 4px;
  background: var(--bg2);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 4px;
  margin-bottom: 24px;
}

.tab {
  flex: 1;
  padding: 8px 16px;
  border: none;
  background: transparent;
  color: var(--muted);
  cursor: pointer;
  border-radius: 8px;
  font-family: var(--font-body);
  font-size: 13px;
  font-weight: 500;
  transition: all 0.2s;
}
.tab:hover { color: var(--text); }
.tab.active { background: var(--card); color: var(--text); }
.tab-panel { display: none; }
.tab-panel.active { display: block; }

/* ─── DIVIDER ─── */
.divider { height: 1px; background: var(--border); margin: 24px 0; }

/* ─── SECTION HEADER ─── */
.section-header {
  display: flex;
  align-items: center;
  justify-content: space-between;
  margin-bottom: 16px;
}

/* ─── AUTOCOMPLETE ─── */
.autocomplete-wrap { position: relative; }
.autocomplete-list {
  position: absolute;
  top: calc(100% + 4px);
  left: 0; right: 0;
  background: var(--card2);
  border: 1px solid var(--border);
  border-radius: 10px;
  z-index: 50;
  max-height: 220px;
  overflow-y: auto;
  display: none;
}
.autocomplete-list.open { display: block; }
.autocomplete-item {
  padding: 10px 14px;
  cursor: pointer;
  font-size: 13px;
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 8px;
}
.autocomplete-item:hover { background: var(--bg3); }
.autocomplete-item .food-meta { font-family: var(--font-mono); font-size: 10px; color: var(--muted); }

/* ─── SCROLLBAR ─── */
::-webkit-scrollbar { width: 4px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 2px; }

/* ─── RESPONSIVE ─── */
@media (max-width: 768px) {
  .sidebar { width: 56px; }
  .main { margin-left: 56px; padding: 16px; }
  .grid-2 { grid-template-columns: 1fr; }
  .grid-3 { grid-template-columns: 1fr 1fr; }
  .grid-4 { grid-template-columns: 1fr 1fr; }
}

/* ─── TOAST ─── */
#toast {
  position: fixed;
  bottom: 24px; right: 24px;
  background: var(--card2);
  border: 1px solid var(--border);
  border-radius: 12px;
  padding: 14px 20px;
  font-size: 13px;
  z-index: 999;
  transform: translateY(80px);
  opacity: 0;
  transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
  display: flex;
  align-items: center;
  gap: 10px;
}
#toast.show { transform: translateY(0); opacity: 1; }
#toast .toast-dot { width: 8px; height: 8px; border-radius: 50%; background: var(--accent); flex-shrink: 0; }

/* ─── LOADING ─── */
.spinner {
  width: 20px; height: 20px;
  border: 2px solid var(--border);
  border-top-color: var(--accent);
  border-radius: 50%;
  animation: spin 0.7s linear infinite;
  display: inline-block;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ─── EMPTY STATE ─── */
.empty {
  text-align: center;
  padding: 40px 20px;
  color: var(--muted);
}
.empty-icon { font-size: 40px; margin-bottom: 12px; opacity: 0.5; }
.empty p { font-size: 13px; }

/* ─── NOISE OVERLAY ─── */
body::before {
  content: '';
  position: fixed;
  inset: 0;
  background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.03'/%3E%3C/svg%3E");
  pointer-events: none;
  z-index: 0;
  opacity: 0.4;
}

/* saved plan list */
.plan-saved-item {
  display: flex; align-items: center; justify-content: space-between;
  padding: 12px 16px;
  background: var(--bg3);
  border: 1px solid var(--border);
  border-radius: 10px;
  margin-bottom: 8px;
}
.plan-saved-item:hover { border-color: var(--accent); }

/* section divider with label */
.section-label {
  display: flex; align-items: center; gap: 12px;
  margin: 24px 0 16px;
}
.section-label span { font-family: var(--font-mono); font-size: 10px; color: var(--muted); letter-spacing: 2px; white-space: nowrap; }
.section-label::before, .section-label::after { content: ''; flex: 1; height: 1px; background: var(--border); }
</style>
</head>
<body>

<!-- SIDEBAR -->
<nav class="sidebar">
  <div class="logo">NUTRI<br>TRACK</div>
  <button class="nav-btn active" onclick="goPage('home')" id="nav-home">
    <svg viewBox="0 0 24 24"><path d="M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
    <span>HOME</span>
  </button>
  <button class="nav-btn elia-btn" onclick="goPage('elia')" id="nav-elia">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M6 20v-2a6 6 0 0112 0v2"/></svg>
    <span>ELIA</span>
  </button>
  <button class="nav-btn alex-btn" onclick="goPage('alex')" id="nav-alex">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="8" r="4"/><path d="M6 20v-2a6 6 0 0112 0v2"/></svg>
    <span>ALEX</span>
  </button>
  <button class="nav-btn" onclick="goPage('goals')" id="nav-goals">
    <svg viewBox="0 0 24 24"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="6"/><circle cx="12" cy="12" r="2"/></svg>
    <span>OBJ</span>
  </button>
</nav>

<main class="main">

  <!-- ═══════ HOME PAGE ═══════ -->
  <div class="page active" id="page-home">
    <div class="page-header">
      <div class="page-title">
        <span class="page-tag">// dashboard</span>
        <h1>Peso & Andamento</h1>
      </div>
      <div style="font-family:var(--font-mono);font-size:12px;color:var(--muted)" id="today-date"></div>
    </div>

    <!-- Weight input cards -->
    <div class="grid-2" style="margin-bottom:24px">
      <!-- ELIA -->
      <div class="card" style="border-top:2px solid var(--elia)">
        <div class="section-header">
          <div>
            <div class="stat-label">Peso oggi</div>
            <h2 style="color:var(--elia)">Elia</h2>
          </div>
          <span class="person-badge elia">ELIA</span>
        </div>
        <div class="weight-input-row">
          <input type="number" id="weight-elia" placeholder="75.0" step="0.1" style="width:130px;font-size:22px;text-align:center;">
          <span style="color:var(--muted);font-family:var(--font-mono)">kg</span>
          <button class="btn btn-elia" onclick="saveWeight('elia')">Salva</button>
        </div>
        <div style="margin-top:12px;display:flex;gap:12px">
          <div>
            <div class="stat-label">Ultimo peso</div>
            <div style="font-family:var(--font-display);font-weight:700;font-size:20px" id="last-elia">—</div>
          </div>
          <div>
            <div class="stat-label">Media sett.</div>
            <div style="font-family:var(--font-display);font-weight:700;font-size:20px" id="weekly-elia">—</div>
          </div>
          <div>
            <div class="stat-label">Media mens.</div>
            <div style="font-family:var(--font-display);font-weight:700;font-size:20px" id="monthly-elia">—</div>
          </div>
        </div>
      </div>

      <!-- ALEX -->
      <div class="card" style="border-top:2px solid var(--alex)">
        <div class="section-header">
          <div>
            <div class="stat-label">Peso oggi</div>
            <h2 style="color:var(--alex)">Alex</h2>
          </div>
          <span class="person-badge alex">ALEX</span>
        </div>
        <div class="weight-input-row">
          <input type="number" id="weight-alex" placeholder="65.0" step="0.1" style="width:130px;font-size:22px;text-align:center;">
          <span style="color:var(--muted);font-family:var(--font-mono)">kg</span>
          <button class="btn btn-alex" onclick="saveWeight('alex')">Salva</button>
        </div>
        <div style="margin-top:12px;display:flex;gap:12px">
          <div>
            <div class="stat-label">Ultimo peso</div>
            <div style="font-family:var(--font-display);font-weight:700;font-size:20px" id="last-alex">—</div>
          </div>
          <div>
            <div class="stat-label">Media sett.</div>
            <div style="font-family:var(--font-display);font-weight:700;font-size:20px" id="weekly-alex">—</div>
          </div>
          <div>
            <div class="stat-label">Media mens.</div>
            <div style="font-family:var(--font-display);font-weight:700;font-size:20px" id="monthly-alex">—</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Chart -->
    <div class="card">
      <div class="section-header">
        <h3>Andamento Peso</h3>
        <div style="display:flex;gap:12px;font-family:var(--font-mono);font-size:11px">
          <span style="color:var(--elia)">● Elia</span>
          <span style="color:var(--alex)">● Alex</span>
        </div>
      </div>
      <div class="chart-wrap">
        <canvas id="weight-chart"></canvas>
      </div>
    </div>
  </div>

  <!-- ═══════ ELIA PAGE ═══════ -->
  <div class="page" id="page-elia">
    <div class="page-header">
      <div class="page-title">
        <span class="page-tag">// sezione personale</span>
        <h1 style="color:var(--elia)">Elia</h1>
      </div>
      <span class="person-badge elia">ELIA</span>
    </div>
    <div id="elia-content"></div>
  </div>

  <!-- ═══════ ALEX PAGE ═══════ -->
  <div class="page" id="page-alex">
    <div class="page-header">
      <div class="page-title">
        <span class="page-tag">// sezione personale</span>
        <h1 style="color:var(--alex)">Alex</h1>
      </div>
      <span class="person-badge alex">ALEX</span>
    </div>
    <div id="alex-content"></div>
  </div>

  <!-- ═══════ GOALS PAGE ═══════ -->
  <div class="page" id="page-goals">
    <div class="page-header">
      <div class="page-title">
        <span class="page-tag">// obbiettivi</span>
        <h1>Obbiettivi</h1>
      </div>
    </div>
    <div class="grid-2">
      <div id="goal-elia-card"></div>
      <div id="goal-alex-card"></div>
    </div>
  </div>

</main>

<!-- TOAST -->
<div id="toast"><div class="toast-dot"></div><span id="toast-msg">Salvato!</span></div>

<script>
// ══════════════════════════════════════════════
// FOOD DATABASE COMPLETO — fonte INRAN (per 100g)
// ══════════════════════════════════════════════
const FOODS = [
  // ─── CARNI BOVINE ───
  {n:"Manzo, filetto crudo",cat:"Carne",kcal:133,p:21.6,c:0,f:5.0},
  {n:"Manzo, fesa cruda",cat:"Carne",kcal:107,p:21.0,c:0,f:2.5},
  {n:"Manzo, costata cruda",cat:"Carne",kcal:185,p:18.7,c:0,f:12.4},
  {n:"Manzo, collo/sottospalla crudo",cat:"Carne",kcal:159,p:19.5,c:0,f:9.0},
  {n:"Manzo, macinato",cat:"Carne",kcal:246,p:17.2,c:0,f:20.0},
  {n:"Vitello, fesa cruda",cat:"Carne",kcal:109,p:21.0,c:0,f:2.8},
  {n:"Vitello, costoletta cruda",cat:"Carne",kcal:124,p:20.5,c:0,f:4.5},
  {n:"Vitello, macinato",cat:"Carne",kcal:136,p:20.0,c:0,f:6.0},
  // ─── CARNI SUINE ───
  {n:"Maiale, lonza cruda",cat:"Carne",kcal:162,p:20.7,c:0,f:9.0},
  {n:"Maiale, bistecca cruda",cat:"Carne",kcal:155,p:20.4,c:0,f:8.5},
  {n:"Maiale, coscio crudo",cat:"Carne",kcal:175,p:19.5,c:0,f:11.0},
  {n:"Maiale, spalla cruda",cat:"Carne",kcal:196,p:18.5,c:0,f:13.5},
  {n:"Maiale, braciola",cat:"Carne",kcal:182,p:20.0,c:0,f:11.5},
  // ─── POLLO / POLLAME ───
  {n:"Petto di pollo crudo",cat:"Carne",kcal:110,p:23.1,c:0,f:1.2},
  {n:"Petto di pollo cotto",cat:"Carne",kcal:165,p:31.0,c:0,f:3.6},
  {n:"Coscia di pollo cruda",cat:"Carne",kcal:178,p:18.3,c:0,f:11.7},
  {n:"Coscia di pollo cotta",cat:"Carne",kcal:197,p:27.0,c:0,f:10.0},
  {n:"Pollo intero crudo",cat:"Carne",kcal:150,p:19.7,c:0,f:8.0},
  {n:"Tacchino, fesa cruda",cat:"Carne",kcal:109,p:23.5,c:0,f:1.5},
  {n:"Tacchino, fesa cotta",cat:"Carne",kcal:157,p:30.0,c:0,f:3.9},
  {n:"Anatra cruda",cat:"Carne",kcal:159,p:21.0,c:0,f:8.5},
  {n:"Quaglia cruda",cat:"Carne",kcal:134,p:22.0,c:0,f:5.0},
  {n:"Coniglio crudo",cat:"Carne",kcal:136,p:22.0,c:0,f:5.5},
  // ─── ALTRE CARNI ───
  {n:"Agnello, coscio crudo",cat:"Carne",kcal:184,p:18.0,c:0,f:12.5},
  {n:"Agnello, spalla cruda",cat:"Carne",kcal:228,p:16.0,c:0,f:18.0},
  {n:"Capretto crudo",cat:"Carne",kcal:105,p:20.5,c:0,f:2.5},
  {n:"Cavallo crudo",cat:"Carne",kcal:119,p:21.5,c:0,f:3.5},
  {n:"Cinghiale crudo",cat:"Carne",kcal:107,p:21.5,c:0,f:2.5},
  {n:"Capriolo crudo",cat:"Carne",kcal:103,p:22.0,c:0,f:1.5},
  {n:"Hamburger (bovino)",cat:"Carne",kcal:232,p:17.0,c:0,f:18.5},
  // ─── FRATTAGLIE ───
  {n:"Fegato di manzo",cat:"Frattaglie",kcal:140,p:21.1,c:3.9,f:3.9},
  {n:"Fegato di pollo",cat:"Frattaglie",kcal:142,p:21.0,c:2.8,f:4.8},
  {n:"Cuore di manzo",cat:"Frattaglie",kcal:124,p:18.9,c:0.6,f:5.0},
  {n:"Rognone di manzo",cat:"Frattaglie",kcal:86,p:16.0,c:0,f:2.6},
  {n:"Trippa di manzo",cat:"Frattaglie",kcal:87,p:14.4,c:0,f:3.3},
  {n:"Cervello di manzo",cat:"Frattaglie",kcal:132,p:10.4,c:0,f:10.3},
  {n:"Lingua di manzo",cat:"Frattaglie",kcal:237,p:16.8,c:0,f:19.0},
  // ─── SALUMI / CARNI TRASFORMATE ───
  {n:"Bresaola della Valtellina",cat:"Salumi",kcal:143,p:29.0,c:0.8,f:2.3},
  {n:"Prosciutto crudo nazionale",cat:"Salumi",kcal:268,p:25.5,c:0,f:18.4},
  {n:"Prosciutto crudo, sgrassato",cat:"Salumi",kcal:145,p:27.5,c:0,f:4.5},
  {n:"Prosciutto di Parma DOP",cat:"Salumi",kcal:286,p:25.9,c:0,f:19.9},
  {n:"Prosciutto di San Daniele DOP",cat:"Salumi",kcal:267,p:26.2,c:0,f:18.0},
  {n:"Prosciutto cotto",cat:"Salumi",kcal:215,p:21.0,c:0.9,f:14.0},
  {n:"Prosciutto cotto sgrassato",cat:"Salumi",kcal:128,p:21.4,c:0.9,f:4.5},
  {n:"Mortadella Bologna IGP",cat:"Salumi",kcal:311,p:14.7,c:1.5,f:28.1},
  {n:"Salame Milano",cat:"Salumi",kcal:389,p:25.0,c:1.5,f:32.4},
  {n:"Salame Napoli",cat:"Salumi",kcal:407,p:24.0,c:2.0,f:34.0},
  {n:"Salame ungherese",cat:"Salumi",kcal:459,p:20.0,c:2.5,f:41.0},
  {n:"Speck Alto Adige IGP",cat:"Salumi",kcal:296,p:26.8,c:0,f:20.7},
  {n:"Coppa",cat:"Salumi",kcal:330,p:24.0,c:0,f:26.6},
  {n:"Pancetta arrotolata",cat:"Salumi",kcal:387,p:16.5,c:0,f:35.3},
  {n:"Pancetta tesa",cat:"Salumi",kcal:415,p:15.0,c:0,f:39.5},
  {n:"Wurstel di suino",cat:"Salumi",kcal:301,p:12.0,c:2.0,f:27.3},
  {n:"Salsiccia fresca di suino",cat:"Salumi",kcal:302,p:14.3,c:0,f:27.3},
  {n:"Cotechino cotto",cat:"Salumi",kcal:290,p:15.8,c:3.0,f:24.4},
  {n:"Zampone cotto",cat:"Salumi",kcal:298,p:17.0,c:2.5,f:25.0},
  {n:"Lardo",cat:"Salumi",kcal:670,p:3.0,c:0,f:72.2},
  {n:"Ciccioli",cat:"Salumi",kcal:491,p:30.0,c:0,f:41.0},
  // ─── PESCE ───
  {n:"Salmone fresco",cat:"Pesce",kcal:208,p:20.0,c:0,f:13.6},
  {n:"Salmone affumicato",cat:"Pesce",kcal:179,p:25.0,c:0,f:9.0},
  {n:"Tonno fresco",cat:"Pesce",kcal:158,p:23.3,c:0,f:6.8},
  {n:"Tonno in scatola al naturale",cat:"Pesce",kcal:103,p:23.0,c:0,f:1.0},
  {n:"Tonno in scatola sott'olio",cat:"Pesce",kcal:218,p:26.0,c:0,f:13.0},
  {n:"Merluzzo fresco",cat:"Pesce",kcal:82,p:18.0,c:0,f:0.7},
  {n:"Merluzzo surgelato",cat:"Pesce",kcal:72,p:16.5,c:0,f:0.5},
  {n:"Orata",cat:"Pesce",kcal:121,p:21.0,c:0,f:4.0},
  {n:"Branzino (spigola)",cat:"Pesce",kcal:88,p:18.7,c:0,f:1.6},
  {n:"Trota",cat:"Pesce",kcal:99,p:18.7,c:0,f:3.0},
  {n:"Aringa fresca",cat:"Pesce",kcal:216,p:18.0,c:0,f:16.0},
  {n:"Sgombro fresco",cat:"Pesce",kcal:205,p:19.0,c:0,f:14.3},
  {n:"Sogliola",cat:"Pesce",kcal:83,p:17.0,c:0,f:1.4},
  {n:"Halibut",cat:"Pesce",kcal:91,p:18.6,c:0,f:1.7},
  {n:"Palombo",cat:"Pesce",kcal:108,p:22.0,c:0,f:2.2},
  {n:"Dentice",cat:"Pesce",kcal:120,p:21.5,c:0,f:4.0},
  {n:"Rombo",cat:"Pesce",kcal:85,p:16.9,c:0,f:2.0},
  {n:"Pesce spada",cat:"Pesce",kcal:121,p:20.3,c:0,f:4.7},
  {n:"Acciughe / Alici fresche",cat:"Pesce",kcal:131,p:20.0,c:0,f:5.8},
  {n:"Acciughe sott'olio",cat:"Pesce",kcal:210,p:25.0,c:0,f:12.6},
  {n:"Anguilla di fiume",cat:"Pesce",kcal:163,p:16.7,c:0,f:11.0},
  {n:"Calamaro",cat:"Pesce",kcal:68,p:15.6,c:0.9,f:0.4},
  {n:"Polpo",cat:"Pesce",kcal:57,p:12.6,c:0.6,f:0.5},
  {n:"Seppie",cat:"Pesce",kcal:72,p:16.0,c:0,f:0.7},
  {n:"Gamberetti",cat:"Pesce",kcal:99,p:20.0,c:0.9,f:1.7},
  {n:"Gamberi",cat:"Pesce",kcal:71,p:13.6,c:0.9,f:1.3},
  {n:"Scampi",cat:"Pesce",kcal:71,p:13.6,c:0.9,f:1.3},
  {n:"Cozze",cat:"Pesce",kcal:84,p:11.9,c:3.4,f:2.7},
  {n:"Vongole",cat:"Pesce",kcal:72,p:11.1,c:2.5,f:2.3},
  {n:"Ostriche",cat:"Pesce",kcal:65,p:9.0,c:2.7,f:2.2},
  {n:"Capesante",cat:"Pesce",kcal:90,p:15.0,c:3.7,f:1.4},
  {n:"Baccalà ammollato",cat:"Pesce",kcal:81,p:19.0,c:0,f:0.4},
  {n:"Surimi",cat:"Pesce",kcal:99,p:15.2,c:6.9,f:0.9},
  // ─── UOVA ───
  {n:"Uovo intero di gallina",cat:"Uova",kcal:155,p:12.5,c:0.7,f:11.1},
  {n:"Albume di uovo",cat:"Uova",kcal:43,p:11.0,c:0.7,f:0.0},
  {n:"Tuorlo di uovo",cat:"Uova",kcal:352,p:16.3,c:0.3,f:31.9},
  {n:"Uova di gallina sode",cat:"Uova",kcal:155,p:12.5,c:0.7,f:11.1},
  {n:"Uova strapazzate",cat:"Uova",kcal:150,p:11.0,c:1.5,f:11.0},
  {n:"Uova di quaglia",cat:"Uova",kcal:158,p:13.1,c:0.4,f:11.1},
  // ─── LATTE E YOGURT ───
  {n:"Latte intero di vacca",cat:"Latte e Yogurt",kcal:64,p:3.3,c:4.9,f:3.6},
  {n:"Latte parzialmente scremato",cat:"Latte e Yogurt",kcal:46,p:3.5,c:5.0,f:1.5},
  {n:"Latte scremato",cat:"Latte e Yogurt",kcal:35,p:3.6,c:5.0,f:0.2},
  {n:"Latte di soia",cat:"Latte e Yogurt",kcal:44,p:3.3,c:2.8,f:2.0},
  {n:"Latte di avena",cat:"Latte e Yogurt",kcal:45,p:1.0,c:8.1,f:1.0},
  {n:"Latte di mandorla",cat:"Latte e Yogurt",kcal:24,p:0.8,c:2.0,f:1.4},
  {n:"Yogurt intero naturale",cat:"Latte e Yogurt",kcal:66,p:4.0,c:4.7,f:3.7},
  {n:"Yogurt magro naturale",cat:"Latte e Yogurt",kcal:36,p:3.8,c:4.8,f:0.1},
  {n:"Yogurt greco intero",cat:"Latte e Yogurt",kcal:115,p:9.0,c:3.8,f:7.7},
  {n:"Yogurt greco 0% grassi",cat:"Latte e Yogurt",kcal:59,p:10.2,c:3.6,f:0.4},
  {n:"Kefir",cat:"Latte e Yogurt",kcal:64,p:3.3,c:4.8,f:3.5},
  // ─── FORMAGGI ───
  {n:"Parmigiano Reggiano DOP",cat:"Formaggi",kcal:431,p:33.0,c:0,f:29.7},
  {n:"Grana Padano DOP",cat:"Formaggi",kcal:383,p:33.0,c:0,f:28.4},
  {n:"Pecorino Romano DOP",cat:"Formaggi",kcal:419,p:26.0,c:0,f:34.5},
  {n:"Mozzarella vaccina",cat:"Formaggi",kcal:254,p:18.0,c:2.2,f:20.0},
  {n:"Mozzarella di bufala",cat:"Formaggi",kcal:264,p:17.0,c:2.0,f:21.0},
  {n:"Ricotta vaccina",cat:"Formaggi",kcal:146,p:11.0,c:3.0,f:10.2},
  {n:"Ricotta di pecora",cat:"Formaggi",kcal:157,p:10.2,c:3.0,f:11.5},
  {n:"Fiocchi di latte (cottage)",cat:"Formaggi",kcal:72,p:12.5,c:3.0,f:0.5},
  {n:"Gorgonzola",cat:"Formaggi",kcal:360,p:19.0,c:0,f:31.0},
  {n:"Taleggio",cat:"Formaggi",kcal:315,p:20.5,c:0,f:25.8},
  {n:"Asiago fresco",cat:"Formaggi",kcal:303,p:22.0,c:0,f:24.0},
  {n:"Fontina DOP",cat:"Formaggi",kcal:343,p:24.5,c:1.6,f:27.0},
  {n:"Scamorza",cat:"Formaggi",kcal:334,p:25.3,c:0,f:26.0},
  {n:"Provolone",cat:"Formaggi",kcal:352,p:25.6,c:0,f:27.8},
  {n:"Brie",cat:"Formaggi",kcal:334,p:20.0,c:0,f:28.0},
  {n:"Camembert",cat:"Formaggi",kcal:297,p:21.0,c:0.5,f:23.5},
  {n:"Emmental",cat:"Formaggi",kcal:403,p:30.0,c:0,f:31.5},
  {n:"Gruyère",cat:"Formaggi",kcal:413,p:29.8,c:0.4,f:32.3},
  {n:"Feta",cat:"Formaggi",kcal:264,p:14.2,c:4.1,f:21.3},
  {n:"Robiola",cat:"Formaggi",kcal:268,p:14.0,c:0,f:23.5},
  {n:"Stracchino",cat:"Formaggi",kcal:256,p:16.5,c:0,f:21.0},
  {n:"Crescenza",cat:"Formaggi",kcal:258,p:16.0,c:0,f:21.5},
  {n:"Mascarpone",cat:"Formaggi",kcal:450,p:7.0,c:4.0,f:45.0},
  {n:"Caciocavallo",cat:"Formaggi",kcal:439,p:27.8,c:1.2,f:36.0},
  {n:"Cacioricotta",cat:"Formaggi",kcal:280,p:19.0,c:0,f:23.0},
  {n:"Formaggio spalmabile light",cat:"Formaggi",kcal:170,p:9.0,c:4.0,f:13.0},
  // ─── CEREALI ───
  {n:"Pasta di semola cruda",cat:"Cereali",kcal:353,p:12.5,c:71.5,f:1.5},
  {n:"Pasta di semola cotta",cat:"Cereali",kcal:158,p:5.8,c:30.9,f:0.9},
  {n:"Pasta integrale cruda",cat:"Cereali",kcal:335,p:13.2,c:66.0,f:2.5},
  {n:"Pasta integrale cotta",cat:"Cereali",kcal:124,p:5.3,c:25.0,f:1.2},
  {n:"Pasta all'uovo cruda",cat:"Cereali",kcal:371,p:13.5,c:68.5,f:5.5},
  {n:"Pasta all'uovo cotta",cat:"Cereali",kcal:165,p:6.4,c:29.7,f:3.3},
  {n:"Riso bianco crudo",cat:"Cereali",kcal:337,p:6.7,c:78.4,f:0.4},
  {n:"Riso bianco cotto",cat:"Cereali",kcal:138,p:2.9,c:31.4,f:0.3},
  {n:"Riso integrale crudo",cat:"Cereali",kcal:335,p:7.5,c:71.0,f:2.5},
  {n:"Riso integrale cotto",cat:"Cereali",kcal:111,p:2.6,c:23.0,f:0.9},
  {n:"Riso basmati crudo",cat:"Cereali",kcal:346,p:7.0,c:78.0,f:0.5},
  {n:"Riso parboiled crudo",cat:"Cereali",kcal:341,p:7.1,c:77.0,f:0.5},
  {n:"Farro perlato crudo",cat:"Cereali",kcal:335,p:13.2,c:67.0,f:2.5},
  {n:"Farro cotto",cat:"Cereali",kcal:130,p:5.0,c:26.0,f:0.7},
  {n:"Orzo perlato crudo",cat:"Cereali",kcal:352,p:9.3,c:73.5,f:1.1},
  {n:"Orzo cotto",cat:"Cereali",kcal:123,p:2.3,c:28.2,f:0.4},
  {n:"Avena, fiocchi",cat:"Cereali",kcal:389,p:16.9,c:66.3,f:6.9},
  {n:"Quinoa cruda",cat:"Cereali",kcal:368,p:14.1,c:64.2,f:6.1},
  {n:"Quinoa cotta",cat:"Cereali",kcal:120,p:4.4,c:21.3,f:1.9},
  {n:"Couscous crudo",cat:"Cereali",kcal:376,p:12.8,c:77.4,f:0.6},
  {n:"Couscous cotto",cat:"Cereali",kcal:112,p:3.8,c:23.2,f:0.2},
  {n:"Mais (granturco) crudo",cat:"Cereali",kcal:365,p:9.2,c:74.3,f:3.8},
  {n:"Polenta cotta",cat:"Cereali",kcal:40,p:0.9,c:8.5,f:0.4},
  {n:"Farina 00",cat:"Cereali",kcal:364,p:11.0,c:76.3,f:0.7},
  {n:"Farina integrale",cat:"Cereali",kcal:339,p:13.0,c:68.0,f:2.5},
  {n:"Semola di grano duro",cat:"Cereali",kcal:362,p:12.5,c:74.5,f:1.1},
  {n:"Farina di riso",cat:"Cereali",kcal:366,p:7.0,c:80.9,f:1.4},
  {n:"Farina di avena",cat:"Cereali",kcal:379,p:13.1,c:68.5,f:6.9},
  // ─── PANE ───
  {n:"Pane bianco (rosetta/francese)",cat:"Pane",kcal:271,p:9.0,c:55.4,f:0.5},
  {n:"Pane integrale",cat:"Pane",kcal:243,p:9.5,c:48.0,f:3.2},
  {n:"Pane di segale",cat:"Pane",kcal:219,p:8.3,c:45.8,f:1.7},
  {n:"Grissini",cat:"Pane",kcal:426,p:11.0,c:81.0,f:7.0},
  {n:"Fette biscottate",cat:"Pane",kcal:411,p:10.6,c:81.0,f:4.9},
  {n:"Fette biscottate integrali",cat:"Pane",kcal:383,p:11.0,c:75.0,f:5.0},
  {n:"Crackers",cat:"Pane",kcal:428,p:9.9,c:75.0,f:10.0},
  {n:"Crackers integrali",cat:"Pane",kcal:399,p:11.0,c:71.0,f:9.5},
  {n:"Gallette di riso",cat:"Pane",kcal:387,p:8.3,c:84.2,f:3.5},
  {n:"Gallette di mais",cat:"Pane",kcal:371,p:7.7,c:80.2,f:3.1},
  {n:"Pizza margherita",cat:"Pane",kcal:255,p:10.0,c:36.0,f:8.5},
  {n:"Focaccia",cat:"Pane",kcal:295,p:7.0,c:44.5,f:10.5},
  {n:"Pane di kamut",cat:"Pane",kcal:260,p:10.5,c:51.0,f:2.0},
  {n:"Piadina",cat:"Pane",kcal:309,p:8.5,c:48.5,f:10.0},
  // ─── CEREALI PER COLAZIONE ───
  {n:"Cornflakes",cat:"Cereali",kcal:372,p:8.0,c:82.7,f:0.6},
  {n:"Muesli",cat:"Cereali",kcal:363,p:9.4,c:66.0,f:7.7},
  {n:"Fiocchi di crusca",cat:"Cereali",kcal:320,p:12.5,c:62.0,f:3.5},
  // ─── PATATE ───
  {n:"Patata cruda",cat:"Verdure",kcal:85,p:2.0,c:19.1,f:0.1},
  {n:"Patata bollita",cat:"Verdure",kcal:77,p:2.0,c:17.5,f:0.1},
  {n:"Patata dolce cruda",cat:"Verdure",kcal:88,p:1.6,c:20.7,f:0.1},
  {n:"Patata dolce cotta",cat:"Verdure",kcal:90,p:2.0,c:20.7,f:0.1},
  // ─── VERDURE E ORTAGGI ───
  {n:"Spinaci crudi",cat:"Verdure",kcal:23,p:2.9,c:3.6,f:0.4},
  {n:"Spinaci cotti",cat:"Verdure",kcal:31,p:3.5,c:5.1,f:0.6},
  {n:"Broccoli crudi",cat:"Verdure",kcal:34,p:2.8,c:7.0,f:0.4},
  {n:"Broccoli cotti",cat:"Verdure",kcal:28,p:3.0,c:5.0,f:0.3},
  {n:"Cavolfiore crudo",cat:"Verdure",kcal:25,p:1.9,c:5.0,f:0.3},
  {n:"Cavolo cappuccio",cat:"Verdure",kcal:25,p:1.4,c:5.1,f:0.2},
  {n:"Cavolo verza",cat:"Verdure",kcal:28,p:2.0,c:5.7,f:0.3},
  {n:"Zucchine crude",cat:"Verdure",kcal:17,p:1.2,c:3.1,f:0.3},
  {n:"Zucchine grigliate",cat:"Verdure",kcal:28,p:1.8,c:4.5,f:0.5},
  {n:"Peperoni crudi",cat:"Verdure",kcal:31,p:1.0,c:6.0,f:0.3},
  {n:"Peperoni grigliati",cat:"Verdure",kcal:40,p:1.5,c:7.5,f:0.5},
  {n:"Melanzane crude",cat:"Verdure",kcal:18,p:1.1,c:3.9,f:0.1},
  {n:"Melanzane grigliate",cat:"Verdure",kcal:36,p:1.8,c:7.2,f:0.4},
  {n:"Pomodori freschi",cat:"Verdure",kcal:18,p:0.9,c:3.9,f:0.2},
  {n:"Pomodori pelati in scatola",cat:"Verdure",kcal:17,p:1.0,c:3.8,f:0.1},
  {n:"Pomodorini ciliegino",cat:"Verdure",kcal:18,p:0.9,c:3.9,f:0.2},
  {n:"Carote crude",cat:"Verdure",kcal:41,p:0.9,c:9.6,f:0.2},
  {n:"Carote cotte",cat:"Verdure",kcal:25,p:0.6,c:5.8,f:0.1},
  {n:"Insalata lattuga",cat:"Verdure",kcal:14,p:1.3,c:2.2,f:0.2},
  {n:"Radicchio rosso",cat:"Verdure",kcal:19,p:1.4,c:4.0,f:0.1},
  {n:"Insalata iceberg",cat:"Verdure",kcal:14,p:0.9,c:2.9,f:0.1},
  {n:"Rucola",cat:"Verdure",kcal:25,p:2.6,c:3.6,f:0.7},
  {n:"Cetrioli",cat:"Verdure",kcal:15,p:0.6,c:3.6,f:0.1},
  {n:"Asparagi",cat:"Verdure",kcal:20,p:2.2,c:3.9,f:0.1},
  {n:"Carciofi",cat:"Verdure",kcal:47,p:3.6,c:10.5,f:0.2},
  {n:"Finocchi",cat:"Verdure",kcal:31,p:1.2,c:7.3,f:0.2},
  {n:"Sedano",cat:"Verdure",kcal:20,p:1.3,c:4.1,f:0.2},
  {n:"Cipolla cruda",cat:"Verdure",kcal:40,p:1.0,c:9.3,f:0.1},
  {n:"Cipolla cotta",cat:"Verdure",kcal:30,p:0.7,c:7.0,f:0.1},
  {n:"Porro crudo",cat:"Verdure",kcal:29,p:1.5,c:6.5,f:0.3},
  {n:"Aglio",cat:"Verdure",kcal:41,p:1.7,c:8.7,f:0.1},
  {n:"Funghi champignon",cat:"Verdure",kcal:22,p:3.1,c:3.3,f:0.3},
  {n:"Funghi porcini freschi",cat:"Verdure",kcal:27,p:3.9,c:4.0,f:0.3},
  {n:"Funghi porcini secchi",cat:"Verdure",kcal:268,p:29.2,c:44.0,f:2.7},
  {n:"Barbabietola rossa",cat:"Verdure",kcal:43,p:1.6,c:9.6,f:0.1},
  {n:"Zucca gialla",cat:"Verdure",kcal:18,p:1.0,c:4.4,f:0.1},
  {n:"Piselli freschi",cat:"Verdure",kcal:67,p:5.0,c:13.0,f:0.4},
  {n:"Piselli surgelati",cat:"Verdure",kcal:77,p:5.5,c:14.0,f:0.5},
  {n:"Mais dolce in scatola",cat:"Verdure",kcal:86,p:3.1,c:18.0,f:1.2},
  {n:"Topinambur",cat:"Verdure",kcal:35,p:1.5,c:7.6,f:0.1},
  {n:"Cavolo nero",cat:"Verdure",kcal:35,p:3.3,c:6.0,f:0.7},
  {n:"Broccoletti (cime di rapa)",cat:"Verdure",kcal:22,p:2.9,c:4.0,f:0.3},
  {n:"Indivia",cat:"Verdure",kcal:17,p:1.3,c:3.5,f:0.2},
  {n:"Rapa cruda",cat:"Verdure",kcal:28,p:0.9,c:6.4,f:0.1},
  {n:"Daikon",cat:"Verdure",kcal:18,p:0.6,c:4.1,f:0.1},
  // ─── LEGUMI ───
  {n:"Ceci cotti",cat:"Legumi",kcal:164,p:8.9,c:27.4,f:2.6},
  {n:"Ceci in scatola sgocciolati",cat:"Legumi",kcal:121,p:7.2,c:20.2,f:2.0},
  {n:"Lenticchie cotte",cat:"Legumi",kcal:116,p:9.0,c:20.1,f:0.4},
  {n:"Lenticchie in scatola",cat:"Legumi",kcal:100,p:7.6,c:17.5,f:0.4},
  {n:"Fagioli borlotti cotti",cat:"Legumi",kcal:133,p:8.7,c:25.0,f:0.5},
  {n:"Fagioli cannellini cotti",cat:"Legumi",kcal:122,p:7.9,c:23.0,f:0.4},
  {n:"Fagioli neri cotti",cat:"Legumi",kcal:132,p:8.9,c:24.0,f:0.5},
  {n:"Fagioli bianchi di Spagna",cat:"Legumi",kcal:130,p:7.5,c:24.5,f:0.4},
  {n:"Fave cotte",cat:"Legumi",kcal:110,p:8.0,c:20.0,f:0.5},
  {n:"Piselli secchi cotti",cat:"Legumi",kcal:118,p:8.3,c:21.6,f:0.4},
  {n:"Soia cotta",cat:"Legumi",kcal:173,p:16.6,c:9.9,f:9.0},
  {n:"Edamame",cat:"Legumi",kcal:121,p:11.0,c:8.9,f:5.2},
  {n:"Tofu",cat:"Legumi",kcal:76,p:8.0,c:1.9,f:4.8},
  {n:"Tempeh",cat:"Legumi",kcal:166,p:18.0,c:9.4,f:5.0},
  {n:"Lupini",cat:"Legumi",kcal:119,p:15.6,c:10.1,f:2.9},
  // ─── FRUTTA ───
  {n:"Mela",cat:"Frutta",kcal:52,p:0.3,c:13.8,f:0.2},
  {n:"Pera",cat:"Frutta",kcal:57,p:0.4,c:15.1,f:0.1},
  {n:"Arancia",cat:"Frutta",kcal:47,p:0.9,c:11.7,f:0.1},
  {n:"Mandarino",cat:"Frutta",kcal:72,p:1.3,c:17.6,f:0.3},
  {n:"Limone",cat:"Frutta",kcal:29,p:1.1,c:6.5,f:0.6},
  {n:"Banana",cat:"Frutta",kcal:89,p:1.1,c:22.8,f:0.3},
  {n:"Uva bianca",cat:"Frutta",kcal:61,p:0.5,c:15.6,f:0.1},
  {n:"Uva nera",cat:"Frutta",kcal:61,p:0.5,c:15.6,f:0.1},
  {n:"Kiwi",cat:"Frutta",kcal:61,p:1.1,c:14.7,f:0.5},
  {n:"Fragole",cat:"Frutta",kcal:32,p:0.7,c:7.7,f:0.3},
  {n:"Mirtilli",cat:"Frutta",kcal:57,p:0.7,c:14.5,f:0.3},
  {n:"More",cat:"Frutta",kcal:36,p:1.4,c:8.1,f:0.5},
  {n:"Lamponi",cat:"Frutta",kcal:34,p:1.2,c:7.4,f:0.7},
  {n:"Pesche",cat:"Frutta",kcal:39,p:0.9,c:9.5,f:0.1},
  {n:"Albicocche",cat:"Frutta",kcal:48,p:1.4,c:11.1,f:0.4},
  {n:"Prugne fresche",cat:"Frutta",kcal:46,p:0.6,c:11.3,f:0.3},
  {n:"Ciliegie",cat:"Frutta",kcal:63,p:1.1,c:15.4,f:0.2},
  {n:"Anguria",cat:"Frutta",kcal:30,p:0.6,c:7.6,f:0.2},
  {n:"Melone",cat:"Frutta",kcal:33,p:0.8,c:7.9,f:0.2},
  {n:"Avocado",cat:"Frutta",kcal:160,p:2.0,c:8.5,f:14.7},
  {n:"Ananas",cat:"Frutta",kcal:41,p:0.5,c:10.6,f:0.1},
  {n:"Mango",cat:"Frutta",kcal:65,p:0.5,c:17.0,f:0.3},
  {n:"Papaya",cat:"Frutta",kcal:43,p:0.5,c:10.8,f:0.1},
  {n:"Cocco fresco",cat:"Frutta",kcal:354,p:3.3,c:15.2,f:33.5},
  {n:"Melagrana",cat:"Frutta",kcal:83,p:1.7,c:18.7,f:1.2},
  {n:"Fichi freschi",cat:"Frutta",kcal:74,p:1.2,c:19.2,f:0.3},
  {n:"Fichi secchi",cat:"Frutta",kcal:256,p:3.6,c:64.5,f:1.2},
  {n:"Datteri secchi",cat:"Frutta",kcal:283,p:2.0,c:75.0,f:0.4},
  {n:"Uvetta sultanina",cat:"Frutta",kcal:289,p:2.5,c:75.0,f:0.5},
  {n:"Prugne secche",cat:"Frutta",kcal:240,p:2.1,c:63.9,f:0.4},
  // ─── FRUTTA SECCA E SEMI ───
  {n:"Mandorle",cat:"Frutta Secca",kcal:597,p:21.2,c:21.7,f:52.5},
  {n:"Noci",cat:"Frutta Secca",kcal:654,p:15.2,c:13.7,f:65.2},
  {n:"Nocciole",cat:"Frutta Secca",kcal:646,p:14.2,c:17.6,f:61.5},
  {n:"Pistacchi",cat:"Frutta Secca",kcal:562,p:20.6,c:27.7,f:45.5},
  {n:"Arachidi",cat:"Frutta Secca",kcal:568,p:26.3,c:18.6,f:49.7},
  {n:"Anacardi",cat:"Frutta Secca",kcal:575,p:17.2,c:32.7,f:46.4},
  {n:"Pinoli",cat:"Frutta Secca",kcal:673,p:13.7,c:13.1,f:68.4},
  {n:"Semi di chia",cat:"Frutta Secca",kcal:490,p:16.5,c:44.3,f:30.7},
  {n:"Semi di lino",cat:"Frutta Secca",kcal:534,p:18.3,c:29.0,f:42.2},
  {n:"Semi di sesamo",cat:"Frutta Secca",kcal:573,p:17.7,c:23.4,f:49.7},
  {n:"Semi di girasole",cat:"Frutta Secca",kcal:584,p:20.8,c:20.0,f:51.5},
  {n:"Semi di zucca",cat:"Frutta Secca",kcal:559,p:30.2,c:17.6,f:49.1},
  {n:"Burro di arachidi",cat:"Frutta Secca",kcal:589,p:25.1,c:20.0,f:50.4},
  {n:"Burro di mandorle",cat:"Frutta Secca",kcal:614,p:21.4,c:20.5,f:55.5},
  // ─── OLI E GRASSI ───
  {n:"Olio extravergine di oliva",cat:"Oli e Grassi",kcal:884,p:0,c:0,f:100.0},
  {n:"Olio di oliva",cat:"Oli e Grassi",kcal:884,p:0,c:0,f:100.0},
  {n:"Olio di semi di girasole",cat:"Oli e Grassi",kcal:884,p:0,c:0,f:100.0},
  {n:"Olio di cocco",cat:"Oli e Grassi",kcal:862,p:0,c:0,f:100.0},
  {n:"Burro",cat:"Oli e Grassi",kcal:717,p:0.9,c:0.1,f:81.1},
  {n:"Margarina",cat:"Oli e Grassi",kcal:717,p:0.5,c:0.5,f:80.0},
  {n:"Strutto",cat:"Oli e Grassi",kcal:892,p:0,c:0,f:99.0},
  {n:"Panna da cucina",cat:"Oli e Grassi",kcal:300,p:2.7,c:3.6,f:31.0},
  {n:"Panna fresca",cat:"Oli e Grassi",kcal:338,p:2.3,c:3.5,f:36.0},
  {n:"Ghee",cat:"Oli e Grassi",kcal:900,p:0,c:0,f:99.9},
  // ─── DOLCI ───
  {n:"Cioccolato fondente 70%",cat:"Dolci",kcal:576,p:5.3,c:43.1,f:42.6},
  {n:"Cioccolato al latte",cat:"Dolci",kcal:535,p:7.7,c:57.0,f:30.7},
  {n:"Cioccolato bianco",cat:"Dolci",kcal:539,p:5.9,c:59.5,f:32.1},
  {n:"Miele",cat:"Dolci",kcal:304,p:0.3,c:80.3,f:0},
  {n:"Marmellata/confettura",cat:"Dolci",kcal:220,p:0.5,c:56.2,f:0.1},
  {n:"Nutella",cat:"Dolci",kcal:539,p:6.3,c:57.5,f:30.9},
  {n:"Torrone",cat:"Dolci",kcal:432,p:9.9,c:64.9,f:16.6},
  {n:"Biscotti secchi",cat:"Dolci",kcal:426,p:8.7,c:78.0,f:9.2},
  {n:"Biscotti integrali",cat:"Dolci",kcal:400,p:9.0,c:72.5,f:9.0},
  {n:"Croissant",cat:"Dolci",kcal:406,p:8.3,c:45.0,f:21.5},
  {n:"Cornetto / Brioche",cat:"Dolci",kcal:362,p:7.5,c:53.0,f:13.5},
  {n:"Gelato alla crema",cat:"Dolci",kcal:222,p:3.9,c:23.0,f:13.5},
  {n:"Gelato alla frutta",cat:"Dolci",kcal:107,p:1.0,c:27.0,f:0.2},
  {n:"Torta (media)",cat:"Dolci",kcal:350,p:5.5,c:54.0,f:13.5},
  {n:"Tiramisù",cat:"Dolci",kcal:310,p:6.5,c:26.0,f:20.0},
  {n:"Panna cotta",cat:"Dolci",kcal:282,p:4.5,c:25.0,f:19.0},
  {n:"Barretta di cioccolato",cat:"Dolci",kcal:490,p:6.0,c:60.0,f:26.0},
  {n:"Zucchero bianco",cat:"Dolci",kcal:392,p:0,c:99.5,f:0},
  {n:"Zucchero di canna",cat:"Dolci",kcal:377,p:0,c:97.0,f:0},
  {n:"Sciroppo d'acero",cat:"Dolci",kcal:260,p:0,c:67.0,f:0},
  {n:"Stevia",cat:"Dolci",kcal:0,p:0,c:0,f:0},
  // ─── PRODOTTI VARI ───
  {n:"Pesto genovese",cat:"Condimenti",kcal:475,p:6.0,c:3.5,f:48.2},
  {n:"Hummus",cat:"Condimenti",kcal:177,p:7.9,c:20.2,f:8.6},
  {n:"Ketchup",cat:"Condimenti",kcal:100,p:1.7,c:25.0,f:0.1},
  {n:"Maionese",cat:"Condimenti",kcal:680,p:1.1,c:3.5,f:74.9},
  {n:"Senape",cat:"Condimenti",kcal:66,p:4.4,c:6.0,f:3.4},
  {n:"Salsa di soia",cat:"Condimenti",kcal:53,p:8.1,c:4.9,f:0.1},
  {n:"Tabasco",cat:"Condimenti",kcal:12,p:0.5,c:2.0,f:0.1},
  {n:"Aceto balsamico",cat:"Condimenti",kcal:88,p:0.5,c:17.0,f:0},
  {n:"Dado da brodo",cat:"Condimenti",kcal:150,p:8.0,c:15.0,f:6.0},
  {n:"Concentrato di pomodoro",cat:"Condimenti",kcal:82,p:4.3,c:17.5,f:0.4},
  {n:"Passata di pomodoro",cat:"Condimenti",kcal:34,p:1.7,c:7.4,f:0.2},
  {n:"Salsa BBQ",cat:"Condimenti",kcal:172,p:1.5,c:41.0,f:0.5},
  {n:"Crema di aceto balsamico",cat:"Condimenti",kcal:320,p:1.0,c:72.0,f:0.5},
  // ─── BEVANDE ───
  {n:"Caffè espresso",cat:"Bevande",kcal:2,p:0.1,c:0,f:0.1},
  {n:"Latte di avena",cat:"Bevande",kcal:45,p:1.0,c:8.1,f:1.0},
  {n:"Succo d'arancia",cat:"Bevande",kcal:45,p:0.7,c:10.4,f:0.2},
  {n:"Succo di mela",cat:"Bevande",kcal:47,p:0.1,c:11.6,f:0.1},
  {n:"Coca-Cola",cat:"Bevande",kcal:42,p:0,c:10.6,f:0},
  {n:"Coca-Cola Zero",cat:"Bevande",kcal:1,p:0,c:0.1,f:0},
  {n:"Acqua tonica",cat:"Bevande",kcal:34,p:0,c:8.8,f:0},
  // ─── ALCOLICI ───
  {n:"Vino rosso (12%)",cat:"Alcolici",kcal:85,p:0.3,c:0.3,f:0},
  {n:"Vino bianco (11%)",cat:"Alcolici",kcal:74,p:0.1,c:0.6,f:0},
  {n:"Birra (4.5%)",cat:"Alcolici",kcal:43,p:0.5,c:3.6,f:0},
  {n:"Birra doppio malto (7%)",cat:"Alcolici",kcal:73,p:0.7,c:6.5,f:0},
  {n:"Spumante / Prosecco",cat:"Alcolici",kcal:80,p:0.1,c:4.0,f:0},
  {n:"Grappa",cat:"Alcolici",kcal:235,p:0,c:0,f:0},
  {n:"Whisky",cat:"Alcolici",kcal:250,p:0,c:0,f:0},
  {n:"Rum",cat:"Alcolici",kcal:231,p:0,c:0,f:0},
  {n:"Vodka",cat:"Alcolici",kcal:231,p:0,c:0,f:0},
  // ─── PROTEINE E INTEGRATORI ───
  {n:"Whey protein (polvere)",cat:"Integratori",kcal:380,p:80.0,c:7.0,f:4.0},
  {n:"Caseina (polvere)",cat:"Integratori",kcal:375,p:82.0,c:5.0,f:2.0},
  {n:"Proteina di pisello",cat:"Integratori",kcal:370,p:80.0,c:8.0,f:3.0},
  {n:"Proteina di riso",cat:"Integratori",kcal:365,p:78.0,c:10.0,f:3.0},
  {n:"Creatina monoidrato",cat:"Integratori",kcal:0,p:0,c:0,f:0},
  {n:"BCAA polvere",cat:"Integratori",kcal:200,p:50.0,c:0,f:0},
  // ─── FAST FOOD / VARI ───
  {n:"Petto di pollo impanato",cat:"Fast Food",kcal:246,p:18.0,c:16.0,f:12.0},
  {n:"Pesce impanato/fritto",cat:"Fast Food",kcal:227,p:12.0,c:15.0,f:13.5},
  {n:"Patatine fritte",cat:"Fast Food",kcal:312,p:4.0,c:38.0,f:16.0},
  {n:"Uova in camicia",cat:"Fast Food",kcal:155,p:12.5,c:0.7,f:11.1},
];

// ══════════════════════════════════════════════
// STATE
// ══════════════════════════════════════════════
let weightChart = null;
let weightDataElia = [];
let weightDataAlex = [];
let mealPlanElia = [];
let mealPlanAlex = [];
let savedPlansElia = [];
let savedPlansAlex = [];
let excessElia = [];
let excessAlex = [];
let goalsData = {};

// ══════════════════════════════════════════════
// NAVIGATION
// ══════════════════════════════════════════════
function goPage(id) {
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
  document.getElementById('page-'+id).classList.add('active');
  document.getElementById('nav-'+id).classList.add('active');
}

// ══════════════════════════════════════════════
// TOAST
// ══════════════════════════════════════════════
function toast(msg, color='var(--accent)') {
  const t = document.getElementById('toast');
  const d = t.querySelector('.toast-dot');
  d.style.background = color;
  document.getElementById('toast-msg').textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}

// ══════════════════════════════════════════════
// DATE
// ══════════════════════════════════════════════
function todayStr() {
  return new Date().toISOString().split('T')[0];
}
function formatDate(str) {
  const d = new Date(str+'T00:00:00');
  return d.toLocaleDateString('it-IT', {day:'2-digit',month:'short'});
}
document.getElementById('today-date').textContent = new Date().toLocaleDateString('it-IT', {weekday:'long',day:'numeric',month:'long',year:'numeric'});

// ══════════════════════════════════════════════
// WEIGHT CHART
// ══════════════════════════════════════════════
function initChart() {
  const ctx = document.getElementById('weight-chart').getContext('2d');
  weightChart = new Chart(ctx, {
    type: 'line',
    data: {
      labels: [],
      datasets: [
        {
          label: 'Elia',
          data: [],
          borderColor: '#f97316',
          backgroundColor: 'rgba(249,115,22,0.08)',
          fill: true,
          tension: 0.4,
          pointBackgroundColor: '#f97316',
          pointRadius: 4,
          pointHoverRadius: 6,
        },
        {
          label: 'Alex',
          data: [],
          borderColor: '#818cf8',
          backgroundColor: 'rgba(129,140,248,0.08)',
          fill: true,
          tension: 0.4,
          pointBackgroundColor: '#818cf8',
          pointRadius: 4,
          pointHoverRadius: 6,
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: { mode: 'index', intersect: false },
      plugins: {
        legend: { display: false },
        tooltip: {
          backgroundColor: '#1f2535',
          borderColor: '#2a3045',
          borderWidth: 1,
          titleColor: '#6b7280',
          bodyColor: '#e8eaf0',
          callbacks: {
            label: ctx => ` ${ctx.dataset.label}: ${ctx.raw} kg`
          }
        }
      },
      scales: {
        x: {
          grid: { color: 'rgba(42,48,69,0.5)' },
          ticks: { color: '#6b7280', font: { family: 'DM Mono', size: 10 } }
        },
        y: {
          grid: { color: 'rgba(42,48,69,0.5)' },
          ticks: { color: '#6b7280', font: { family: 'DM Mono', size: 10 }, callback: v => v+' kg' }
        }
      }
    }
  });
}

function updateChart() {
  // Merge all dates
  const allDates = [...new Set([
    ...weightDataElia.map(w=>w.date),
    ...weightDataAlex.map(w=>w.date)
  ])].sort();

  const labels = allDates.map(formatDate);
  const eliaData = allDates.map(d => { const r = weightDataElia.find(w=>w.date===d); return r ? r.weight : null; });
  const alexData = allDates.map(d => { const r = weightDataAlex.find(w=>w.date===d); return r ? r.weight : null; });

  weightChart.data.labels = labels;
  weightChart.data.datasets[0].data = eliaData;
  weightChart.data.datasets[1].data = alexData;
  weightChart.update();
}

function computeStats(data) {
  if (!data.length) return {last:'—', weekly:'—', monthly:'—'};
  const sorted = [...data].sort((a,b)=>b.date.localeCompare(a.date));
  const last = sorted[0].weight.toFixed(1)+' kg';
  const now = new Date();
  // Weekly: last 7 days
  const weekAgo = new Date(now); weekAgo.setDate(weekAgo.getDate()-7);
  const weekData = data.filter(w => new Date(w.date+'T00:00:00') >= weekAgo);
  const weekly = weekData.length ? (weekData.reduce((a,b)=>a+b.weight,0)/weekData.length).toFixed(1)+' kg' : '—';
  // Monthly: current month
  const monthStr = now.toISOString().slice(0,7);
  const monthData = data.filter(w => w.date.startsWith(monthStr));
  const monthly = monthData.length ? (monthData.reduce((a,b)=>a+b.weight,0)/monthData.length).toFixed(1)+' kg' : '—';
  return {last, weekly, monthly};
}

function updateStats() {
  const s1 = computeStats(weightDataElia);
  document.getElementById('last-elia').textContent = s1.last;
  document.getElementById('weekly-elia').textContent = s1.weekly;
  document.getElementById('monthly-elia').textContent = s1.monthly;
  const s2 = computeStats(weightDataAlex);
  document.getElementById('last-alex').textContent = s2.last;
  document.getElementById('weekly-alex').textContent = s2.weekly;
  document.getElementById('monthly-alex').textContent = s2.monthly;
  // Also update goal progress
  updateGoalProgress();
}

// ══════════════════════════════════════════════
// FIREBASE WEIGHT OPERATIONS
// ══════════════════════════════════════════════
async function saveWeight(person) {
  const val = parseFloat(document.getElementById('weight-'+person).value);
  if (!val || val < 20 || val > 300) { toast('Inserisci un peso valido!', 'var(--danger)'); return; }
  const {db, dbFns} = window;
  const {doc, setDoc} = dbFns;
  const today = todayStr();
  try {
    await setDoc(doc(db, 'weights', `${person}_${today}`), {
      person, date: today, weight: val, ts: Date.now()
    });
    toast(`Peso di ${person === 'elia' ? 'Elia' : 'Alex'} salvato! (${val} kg)`, person === 'elia' ? 'var(--elia)' : 'var(--alex)');
    document.getElementById('weight-'+person).value = '';
  } catch(e) { toast('Errore salvataggio: '+e.message, 'var(--danger)'); }
}

async function loadWeights() {
  const {db, dbFns} = window;
  const {collection, getDocs, query, orderBy} = dbFns;
  try {
    const snap = await getDocs(query(collection(db,'weights'), orderBy('date','asc')));
    weightDataElia = [];
    weightDataAlex = [];
    snap.forEach(d => {
      const data = d.data();
      if(data.person === 'elia') weightDataElia.push(data);
      else weightDataAlex.push(data);
    });
    updateStats();
    updateChart();
  } catch(e) { console.error(e); }
}

// ══════════════════════════════════════════════
// PERSON PAGE BUILDER
// ══════════════════════════════════════════════
function buildPersonPage(person) {
  const isElia = person === 'elia';
  const color = isElia ? 'var(--elia)' : 'var(--alex)';
  const name = isElia ? 'Elia' : 'Alex';
  const mp = isElia ? mealPlanElia : mealPlanAlex;

  const el = document.getElementById(person+'-content');
  el.innerHTML = `
    <div class="tabs" id="tabs-${person}">
      <button class="tab active" onclick="switchTab('${person}','diet')">🥗 Piano Alimentare</button>
      <button class="tab" onclick="switchTab('${person}','plans')">📋 Piani Salvati</button>
      <button class="tab" onclick="switchTab('${person}','excess')">⚠️ Pasti in Eccesso</button>
    </div>

    <!-- TAB DIET -->
    <div class="tab-panel active" id="tp-${person}-diet">
      <div class="card" style="margin-bottom:20px">
        <h3 style="margin-bottom:16px">Aggiungi Alimento al Piano</h3>
        <div style="display:flex;gap:12px;flex-wrap:wrap;align-items:flex-end">
          <div style="flex:1;min-width:200px">
            <div class="autocomplete-wrap">
              <input type="text" id="food-search-${person}" placeholder="Cerca alimento..." oninput="searchFood('${person}')" autocomplete="off">
              <div class="autocomplete-list" id="food-ac-${person}"></div>
            </div>
          </div>
          <div style="width:110px">
            <div style="font-size:11px;color:var(--muted);margin-bottom:4px;font-family:var(--font-mono)">GRAMMI</div>
            <input type="number" id="food-grams-${person}" placeholder="100" min="1" max="2000" value="100">
          </div>
          <button class="btn" style="background:${color};color:white;white-space:nowrap" onclick="addFoodToPlan('${person}')">+ Aggiungi</button>
        </div>
      </div>

      <div class="section-header">
        <h3>Piano Attuale — ${name}</h3>
        <div style="display:flex;gap:8px">
          <button class="btn btn-ghost btn-sm" onclick="clearPlan('${person}')">Svuota</button>
          <button class="btn btn-sm" style="background:${color};color:white" onclick="openSavePlanModal('${person}')">💾 Salva Piano</button>
        </div>
      </div>

      <div id="plan-items-${person}">
        <div class="empty"><div class="empty-icon">🍽️</div><p>Nessun alimento nel piano. Inizia ad aggiungere!</p></div>
      </div>

      <div class="totals-bar" id="totals-${person}" style="display:none">
        <div class="total-item"><div class="val" id="tot-kcal-${person}" style="color:var(--accent)">0</div><div class="lbl">KCAL</div></div>
        <div class="total-item"><div class="val" id="tot-p-${person}" style="color:var(--accent2)">0g</div><div class="lbl">PROT</div></div>
        <div class="total-item"><div class="val" id="tot-c-${person}" style="color:var(--accent3)">0g</div><div class="lbl">CARB</div></div>
        <div class="total-item"><div class="val" id="tot-f-${person}" style="color:#fbbf24">0g</div><div class="lbl">GRASSI</div></div>
      </div>
    </div>

    <!-- TAB PLANS -->
    <div class="tab-panel" id="tp-${person}-plans">
      <div class="section-header">
        <h3>Piani Salvati</h3>
      </div>
      <div id="saved-plans-${person}"></div>
    </div>

    <!-- TAB EXCESS -->
    <div class="tab-panel" id="tp-${person}-excess">
      <div class="card" style="margin-bottom:20px">
        <h3 style="margin-bottom:16px">Registra Pasto in Eccesso</h3>
        <div style="display:flex;gap:12px;flex-wrap:wrap">
          <div style="flex:1;min-width:200px">
            <div style="font-size:11px;color:var(--muted);margin-bottom:4px;font-family:var(--font-mono)">DATA</div>
            <input type="date" id="excess-date-${person}" value="${todayStr()}">
          </div>
          <div style="flex:2;min-width:200px">
            <div style="font-size:11px;color:var(--muted);margin-bottom:4px;font-family:var(--font-mono)">DESCRIZIONE</div>
            <input type="text" id="excess-desc-${person}" placeholder="Es. Pizza, birra, dessert...">
          </div>
          <div style="width:100px">
            <div style="font-size:11px;color:var(--muted);margin-bottom:4px;font-family:var(--font-mono)">KCAL EST.</div>
            <input type="number" id="excess-kcal-${person}" placeholder="500">
          </div>
          <div style="display:flex;align-items:flex-end">
            <button class="btn" style="background:${color};color:white" onclick="addExcess('${person}')">+ Aggiungi</button>
          </div>
        </div>
      </div>

      <div id="excess-table-wrap-${person}">
        <div class="empty"><div class="empty-icon">✅</div><p>Nessun pasto in eccesso registrato!</p></div>
      </div>
    </div>
  `;

  // Load data
  loadSavedPlans(person);
  loadExcess(person);
  renderPlan(person);
}

// ══════════════════════════════════════════════
// TABS WITHIN PERSON PAGE
// ══════════════════════════════════════════════
function switchTab(person, tab) {
  document.querySelectorAll(`#tabs-${person} .tab`).forEach(t => t.classList.remove('active'));
  document.querySelectorAll(`[id^="tp-${person}-"]`).forEach(p => p.classList.remove('active'));
  const panels = {diet:0, plans:1, excess:2};
  document.querySelectorAll(`#tabs-${person} .tab`)[panels[tab]].classList.add('active');
  document.getElementById(`tp-${person}-${tab}`).classList.add('active');
}

// ══════════════════════════════════════════════
// FOOD SEARCH AUTOCOMPLETE
// ══════════════════════════════════════════════
let selectedFood = {elia: null, alex: null};

function searchFood(person) {
  const q = document.getElementById('food-search-'+person).value.toLowerCase().trim();
  const list = document.getElementById('food-ac-'+person);
  if (!q) { list.classList.remove('open'); selectedFood[person] = null; return; }
  const matches = FOODS.filter(f => f.n.toLowerCase().includes(q) || (f.cat||'').toLowerCase().includes(q)).slice(0, 12);
  if (!matches.length) { list.classList.remove('open'); return; }
  list.innerHTML = matches.map((f,i) => {
    const catLabel = f.cat ? '<span style="font-size:10px;color:var(--muted);margin-left:6px">['+f.cat+']</span>' : '';
    return '<div class="autocomplete-item" onclick="selectFoodIdx(\''+person+'\','+i+',\''+f.n.replace(/'/g,"\\'")+'\')">'
      + '<div><span style="font-size:13px">'+f.n+'</span>'+catLabel+'</div>'
      + '<span class="food-meta">'+f.kcal+' kcal · P:'+f.p+'g C:'+f.c+'g G:'+f.f+'g</span>'
      + '</div>';
  }).join('');
  list._matches = matches;
  list.classList.add('open');
}

function selectFoodIdx(person, idx, name) {
  const list = document.getElementById('food-ac-'+person);
  document.getElementById('food-search-'+person).value = name;
  selectedFood[person] = list._matches ? list._matches[idx] : FOODS.find(f => f.n === name);
  list.classList.remove('open');
}

function selectFood(person, name) {
  document.getElementById('food-search-'+person).value = name;
  selectedFood[person] = FOODS.find(f => f.n === name);
  document.getElementById('food-ac-'+person).classList.remove('open');
}

document.addEventListener('click', e => {
  ['elia','alex'].forEach(p => {
    const ac = document.getElementById(`food-ac-${p}`);
    if (ac && !ac.contains(e.target)) ac.classList.remove('open');
  });
});

// ══════════════════════════════════════════════
// MEAL PLAN
// ══════════════════════════════════════════════
function addFoodToPlan(person) {
  const food = selectedFood[person];
  if (!food) { toast('Seleziona un alimento dalla lista!', 'var(--danger)'); return; }
  const grams = parseFloat(document.getElementById(`food-grams-${person}`).value) || 100;
  const arr = person === 'elia' ? mealPlanElia : mealPlanAlex;
  arr.push({ ...food, grams, id: Date.now() });
  document.getElementById(`food-search-${person}`).value = '';
  document.getElementById(`food-grams-${person}`).value = 100;
  selectedFood[person] = null;
  renderPlan(person);
}

function removeFoodFromPlan(person, id) {
  if (person === 'elia') mealPlanElia = mealPlanElia.filter(f => f.id !== id);
  else mealPlanAlex = mealPlanAlex.filter(f => f.id !== id);
  renderPlan(person);
}

function updateGrams(person, id, grams) {
  const arr = person === 'elia' ? mealPlanElia : mealPlanAlex;
  const item = arr.find(f => f.id === id);
  if (item) item.grams = parseFloat(grams) || 0;
  renderPlanTotals(person);
}

function clearPlan(person) {
  if (person === 'elia') mealPlanElia = [];
  else mealPlanAlex = [];
  renderPlan(person);
}

function calcMacros(item) {
  const f = item.grams / 100;
  return {
    kcal: Math.round(item.kcal * f),
    p: (item.p * f).toFixed(1),
    c: (item.c * f).toFixed(1),
    fat: (item.f * f).toFixed(1)
  };
}

function renderPlan(person) {
  const arr = person === 'elia' ? mealPlanElia : mealPlanAlex;
  const container = document.getElementById(`plan-items-${person}`);
  const totalsBar = document.getElementById(`totals-${person}`);
  if (!container) return;

  if (!arr.length) {
    container.innerHTML = `<div class="empty"><div class="empty-icon">🍽️</div><p>Nessun alimento nel piano. Inizia ad aggiungere!</p></div>`;
    totalsBar.style.display = 'none';
    return;
  }

  container.innerHTML = arr.map(item => {
    const m = calcMacros(item);
    return `
      <div class="meal-item">
        <div class="food-name">${item.n}</div>
        <input type="number" class="gram-input" value="${item.grams}" min="1" max="2000"
          oninput="updateGrams('${person}',${item.id},this.value)" style="width:80px">
        <span style="color:var(--muted);font-size:12px">g</span>
        <div class="macros-mini">
          <span class="macro-chip kcal">${m.kcal} kcal</span>
          <span class="macro-chip prot">P ${m.p}g</span>
          <span class="macro-chip carb">C ${m.c}g</span>
          <span class="macro-chip fat">G ${m.fat}g</span>
        </div>
        <button class="btn btn-danger btn-sm btn-icon" onclick="removeFoodFromPlan('${person}',${item.id})">✕</button>
      </div>
    `;
  }).join('');

  totalsBar.style.display = 'flex';
  renderPlanTotals(person);
}

function renderPlanTotals(person) {
  const arr = person === 'elia' ? mealPlanElia : mealPlanAlex;
  let totKcal=0, totP=0, totC=0, totF=0;
  arr.forEach(item => {
    const m = calcMacros(item);
    totKcal += m.kcal;
    totP += parseFloat(m.p);
    totC += parseFloat(m.c);
    totF += parseFloat(m.fat);
  });
  const el = id => document.getElementById(id);
  if(el(`tot-kcal-${person}`)) {
    el(`tot-kcal-${person}`).textContent = totKcal;
    el(`tot-p-${person}`).textContent = totP.toFixed(1)+'g';
    el(`tot-c-${person}`).textContent = totC.toFixed(1)+'g';
    el(`tot-f-${person}`).textContent = totF.toFixed(1)+'g';
  }
}

// ══════════════════════════════════════════════
// SAVE / LOAD PLANS
// ══════════════════════════════════════════════
function openSavePlanModal(person) {
  const name = prompt('Nome del piano (es. "Giorno 1 - Bulk"):');
  if (!name) return;
  savePlan(person, name);
}

async function savePlan(person, planName) {
  const arr = person === 'elia' ? mealPlanElia : mealPlanAlex;
  if (!arr.length) { toast('Aggiungi almeno un alimento!', 'var(--danger)'); return; }
  const {db, dbFns} = window;
  const {collection, addDoc} = dbFns;
  try {
    await addDoc(collection(db, 'plans'), {
      person, name: planName, items: arr.map(i=>({n:i.n,kcal:i.kcal,p:i.p,c:i.c,f:i.f,grams:i.grams})),
      createdAt: Date.now()
    });
    toast('Piano salvato: '+planName, person==='elia'?'var(--elia)':'var(--alex)');
    loadSavedPlans(person);
  } catch(e) { toast('Errore: '+e.message,'var(--danger)'); }
}

async function loadSavedPlans(person) {
  const {db, dbFns} = window;
  const {collection, getDocs, query, orderBy} = dbFns;
  try {
    const snap = await getDocs(query(collection(db,'plans'), orderBy('createdAt','desc')));
    const plans = [];
    snap.forEach(d => { if(d.data().person === person) plans.push({id:d.id,...d.data()}); });
    if(person==='elia') savedPlansElia = plans;
    else savedPlansAlex = plans;
    renderSavedPlans(person);
  } catch(e) { console.error(e); }
}

function renderSavedPlans(person) {
  const plans = person==='elia' ? savedPlansElia : savedPlansAlex;
  const el = document.getElementById(`saved-plans-${person}`);
  if (!el) return;
  if (!plans.length) {
    el.innerHTML = `<div class="empty"><div class="empty-icon">📋</div><p>Nessun piano salvato ancora.</p></div>`;
    return;
  }
  const color = person==='elia'?'var(--elia)':'var(--alex)';
  el.innerHTML = plans.map(plan => {
    const totKcal = plan.items.reduce((a,i) => a + Math.round(i.kcal * i.grams/100), 0);
    const totP = plan.items.reduce((a,i) => a + i.p * i.grams/100, 0).toFixed(1);
    return `
      <div class="plan-saved-item">
        <div>
          <div style="font-weight:600;margin-bottom:4px">${plan.name}</div>
          <div style="display:flex;gap:8px">
            <span class="macro-chip kcal">${totKcal} kcal</span>
            <span class="macro-chip prot">P ${totP}g</span>
            <span style="font-family:var(--font-mono);font-size:10px;color:var(--muted)">${plan.items.length} alimenti</span>
          </div>
        </div>
        <div style="display:flex;gap:8px">
          <button class="btn btn-ghost btn-sm" onclick="loadPlanIntoEditor('${person}','${plan.id}')">📥 Carica</button>
          <button class="btn btn-danger btn-sm" onclick="deletePlan('${person}','${plan.id}')">✕</button>
        </div>
      </div>
      <div id="plan-detail-${plan.id}" style="display:none;margin-bottom:8px;padding:12px;background:var(--bg3);border-radius:8px;font-size:12px">
        ${plan.items.map(i=>
          `<div style="display:flex;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--border)">
            <span>${i.n}</span>
            <span style="color:var(--muted)">${i.grams}g → ${Math.round(i.kcal*i.grams/100)} kcal</span>
          </div>`
        ).join('')}
      </div>
    `;
  }).join('');
}

function loadPlanIntoEditor(person, planId) {
  const plans = person==='elia' ? savedPlansElia : savedPlansAlex;
  const plan = plans.find(p=>p.id===planId);
  if(!plan) return;
  const items = plan.items.map((i,idx) => ({...i, id: Date.now()+idx}));
  if(person==='elia') mealPlanElia = items;
  else mealPlanAlex = items;
  switchTab(person, 'diet');
  renderPlan(person);
  toast('Piano caricato nell\'editor!', person==='elia'?'var(--elia)':'var(--alex)');
}

async function deletePlan(person, planId) {
  if(!confirm('Eliminare questo piano?')) return;
  const {db, dbFns} = window;
  const {doc, deleteDoc} = dbFns;
  await deleteDoc(doc(db,'plans',planId));
  loadSavedPlans(person);
  toast('Piano eliminato', 'var(--danger)');
}

// ══════════════════════════════════════════════
// EXCESS MEALS
// ══════════════════════════════════════════════
async function addExcess(person) {
  const date = document.getElementById(`excess-date-${person}`).value;
  const desc = document.getElementById(`excess-desc-${person}`).value.trim();
  const kcal = document.getElementById(`excess-kcal-${person}`).value;
  if (!desc) { toast('Inserisci una descrizione!', 'var(--danger)'); return; }
  const {db, dbFns} = window;
  const {collection, addDoc} = dbFns;
  try {
    await addDoc(collection(db,'excess'), { person, date, desc, kcal: parseFloat(kcal)||0, ts: Date.now() });
    document.getElementById(`excess-desc-${person}`).value = '';
    document.getElementById(`excess-kcal-${person}`).value = '';
    toast('Pasto in eccesso registrato!', 'var(--danger)');
    loadExcess(person);
  } catch(e) { toast('Errore: '+e.message,'var(--danger)'); }
}

async function loadExcess(person) {
  const {db, dbFns} = window;
  const {collection, getDocs, query, orderBy} = dbFns;
  try {
    const snap = await getDocs(query(collection(db,'excess'), orderBy('ts','desc')));
    const items = [];
    snap.forEach(d => { if(d.data().person===person) items.push({id:d.id,...d.data()}); });
    if(person==='elia') excessElia = items;
    else excessAlex = items;
    renderExcess(person);
  } catch(e) { console.error(e); }
}

async function deleteExcess(person, id) {
  const {db, dbFns} = window;
  const {doc, deleteDoc} = dbFns;
  await deleteDoc(doc(db,'excess',id));
  loadExcess(person);
}

function renderExcess(person) {
  const items = person==='elia' ? excessElia : excessAlex;
  const el = document.getElementById(`excess-table-wrap-${person}`);
  if (!el) return;
  if(!items.length) {
    el.innerHTML = `<div class="empty"><div class="empty-icon">✅</div><p>Nessun pasto in eccesso registrato!</p></div>`;
    return;
  }
  el.innerHTML = `
    <div class="card card-sm" style="padding:0;overflow:hidden">
      <table class="excess-table">
        <thead>
          <tr>
            <th>DATA</th>
            <th>DESCRIZIONE</th>
            <th>KCAL EST.</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          ${items.map(i=>`
            <tr>
              <td style="font-family:var(--font-mono);font-size:11px;color:var(--muted)">${formatDate(i.date)}</td>
              <td>${i.desc}</td>
              <td><span class="macro-chip kcal">${i.kcal||'—'} kcal</span></td>
              <td><button class="btn btn-danger btn-sm btn-icon" onclick="deleteExcess('${person}','${i.id}')">✕</button></td>
            </tr>
          `).join('')}
        </tbody>
      </table>
    </div>
  `;
}

// ══════════════════════════════════════════════
// GOALS PAGE
// ══════════════════════════════════════════════
function buildGoalsPage() {
  buildGoalCard('elia');
  buildGoalCard('alex');
}

async function buildGoalCard(person) {
  const {db, dbFns} = window;
  const {doc, getDoc} = dbFns;
  const isElia = person==='elia';
  const color = isElia ? 'var(--elia)' : 'var(--alex)';
  const name = isElia ? 'Elia' : 'Alex';
  const el = document.getElementById(`goal-${person}-card`);

  let goal = null;
  try {
    const snap = await getDoc(doc(db,'goals',person));
    if(snap.exists()) goal = snap.data();
  } catch(e) {}

  const lastWeight = (isElia ? weightDataElia : weightDataAlex).sort((a,b)=>b.date.localeCompare(a.date))[0];
  const current = lastWeight ? lastWeight.weight : null;

  let progress = null, progressText = '', diff = '';
  if(goal && current) {
    const start = goal.startWeight;
    const target = goal.targetWeight;
    if(start !== target) {
      const totalChange = target - start;
      const currentChange = current - start;
      const pct = Math.min(100, Math.max(0, (currentChange / totalChange)*100));
      progress = pct;
      diff = (current - target).toFixed(1);
      const diffNum = parseFloat(diff);
      if(Math.abs(diffNum) < 0.3) progressText = '🎯 Obbiettivo raggiunto!';
      else if(diffNum < 0) progressText = `Ancora ${Math.abs(diffNum)} kg da perdere`;
      else progressText = `Ancora ${diffNum} kg da guadagnare`;
    }
  }

  el.innerHTML = `
    <div class="card" style="border-top:2px solid ${color};height:100%">
      <div style="display:flex;align-items:center;justify-content:space-between;margin-bottom:20px">
        <h2 style="color:${color}">${name}</h2>
        <span class="person-badge ${person}">${person.toUpperCase()}</span>
      </div>

      <div style="margin-bottom:20px">
        <div class="stat-label">Peso attuale</div>
        <div style="font-family:var(--font-display);font-weight:700;font-size:32px">${current ? current+' kg' : '—'}</div>
      </div>

      <div class="divider"></div>

      <h3 style="margin-bottom:16px">Imposta Obbiettivo</h3>
      <div style="display:flex;flex-direction:column;gap:12px;margin-bottom:16px">
        <div>
          <div style="font-size:11px;color:var(--muted);margin-bottom:4px;font-family:var(--font-mono)">PESO PARTENZA (kg)</div>
          <input type="number" id="goal-start-${person}" step="0.1" value="${goal?.startWeight||''}" placeholder="${current||75}">
        </div>
        <div>
          <div style="font-size:11px;color:var(--muted);margin-bottom:4px;font-family:var(--font-mono)">OBBIETTIVO PESO (kg)</div>
          <input type="number" id="goal-target-${person}" step="0.1" value="${goal?.targetWeight||''}" placeholder="es. 70">
        </div>
        <div>
          <div style="font-size:11px;color:var(--muted);margin-bottom:4px;font-family:var(--font-mono)">NOTE / STRATEGIA</div>
          <textarea id="goal-note-${person}" placeholder="Es: -0.5kg/settimana, deficit 400kcal...">${goal?.note||''}</textarea>
        </div>
        <button class="btn" style="background:${color};color:white" onclick="saveGoal('${person}')">Salva Obbiettivo</button>
      </div>

      ${goal ? `
        <div class="divider"></div>
        <h3 style="margin-bottom:12px">Progressi</h3>
        ${progress !== null ? `
          <div style="display:flex;justify-content:space-between;margin-bottom:6px">
            <span style="font-size:13px">${progressText}</span>
            <span style="font-family:var(--font-mono);font-size:13px;color:${color}">${progress.toFixed(0)}%</span>
          </div>
          <div class="goal-progress">
            <div class="goal-progress-fill" style="width:${progress}%;background:${color}"></div>
          </div>
          <div style="display:flex;justify-content:space-between;margin-top:8px;font-family:var(--font-mono);font-size:10px;color:var(--muted)">
            <span>START: ${goal.startWeight} kg</span>
            <span>TARGET: ${goal.targetWeight} kg</span>
          </div>
        ` : '<p style="color:var(--muted);font-size:13px">Inserisci un peso per vedere i progressi.</p>'}
        ${goal.note ? `<div style="margin-top:12px;padding:12px;background:var(--bg3);border-radius:8px;font-size:13px;color:var(--muted)">${goal.note}</div>` : ''}
      ` : ''}
    </div>
  `;
}

async function saveGoal(person) {
  const start = parseFloat(document.getElementById(`goal-start-${person}`).value);
  const target = parseFloat(document.getElementById(`goal-target-${person}`).value);
  const note = document.getElementById(`goal-note-${person}`).value;
  if(!start || !target) { toast('Inserisci peso di partenza e obbiettivo!','var(--danger)'); return; }
  const {db, dbFns} = window;
  const {doc, setDoc} = dbFns;
  try {
    await setDoc(doc(db,'goals',person), { startWeight:start, targetWeight:target, note, updatedAt: Date.now() });
    toast('Obbiettivo salvato!', person==='elia'?'var(--elia)':'var(--alex)');
    buildGoalCard(person);
  } catch(e) { toast('Errore: '+e.message,'var(--danger)'); }
}

function updateGoalProgress() {
  // Rebuild goal cards if on goals page (non-blocking)
  if(document.getElementById('page-goals').classList.contains('active')) {
    buildGoalCard('elia');
    buildGoalCard('alex');
  }
}

// ══════════════════════════════════════════════
// INIT
// ══════════════════════════════════════════════
function init() {
  initChart();
  buildPersonPage('elia');
  buildPersonPage('alex');
  buildGoalsPage();
  loadWeights();

  // Realtime listener for weights
  const {db, dbFns} = window;
  const {collection, query, orderBy, onSnapshot} = dbFns;
  onSnapshot(query(collection(db,'weights'), orderBy('date','asc')), snap => {
    weightDataElia = [];
    weightDataAlex = [];
    snap.forEach(d => {
      const data = d.data();
      if(data.person==='elia') weightDataElia.push(data);
      else weightDataAlex.push(data);
    });
    updateStats();
    updateChart();
  });
}

document.addEventListener('firebaseReady', init);
if(window.firebaseReady) init();
</script>
</body>
</html>
